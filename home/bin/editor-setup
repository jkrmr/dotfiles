#!/usr/bin/env bash

#
# editor-setup
#
# Usage:
#   mx [OPTIONS]
#
#   Install some libraries.
#
# Examples:
#   editor-setup
#   editor-setup py
#   editor-setup rb py js
#   editor-setup js mac py
#   editor-setup all
#

set -e

setup_ruby() {
    gem install --update-sources \
        bundler-gtags \
        colorize \
        fastri \
        gem-browse \
        gem-ctags \
        jazz_fingers \
        neovim \
        pretty_backtrace \
        pry \
        pry-byebug \
        pry-theme \
        rcodetools \
        rufo \
        seeing_is_believing \
        solargraph \
        sqlint \
        thor \
        tmuxinator
}

setup_javascript() {
    npm install --update --global \
        babel-eslint \
        bash-language-server \
        eslint \
        eslint-plugin-react \
        javascript-typescript-langserver \
        markdownlint-cli \
        neovim \
        prettier \
        prettier-standard \
        typescript \
        vmd
}

setup_python() {
    pip install --upgrade \
        "jedi<0.15.0" \
        "json-rpc>=1.8.1" \
        "service_factory>=0.1.5" \
        autoflake \
        black \
        epc \
        hy \
        importmagic \
        ipdb \
        ipython \
        isort \
        mypy \
        pyls-black \
        pyls-isort \
        pyls-mypy \
        pynvim \
        solargraph-utils.py \
        vim-vint \
        yapf
}

setup_mac() {
    if [[ "$MACHINE" == "mac" ]]; then
        # https://github.com/syl20bnr/spacemacs/issues/11541
        # if using dark mode, you'll need this
        # to disable: defaults delete org.gnu.Emacs NSRequiresAquaSystemAppearance
        echo defaults write org.gnu.Emacs NSRequiresAquaSystemAppearance true
        defaults write org.gnu.Emacs NSRequiresAquaSystemAppearance true
    fi
}

message() {
    gprintf "\n-----------------------\n"
    gprintf "%s\n" "$1"
    gprintf "-----------------------\n\n"
}

usage() {
    grep '^#' < "$0" | tail -n +2 | cut -c 3-
}

[[ "$*" =~ "--help" ]] && usage && exit 2

[[ -z "$1" ]] && set -- all


while [ $# -gt -1 ]; do
    case "$1" in
        'all')
            set -- mac py rb js
            ;;
        'js')
            message "Installing JavaScript Libraries"
            setup_javascript
            shift
            ;;
        'py')
            message "Installing Python Libraries"
            setup_python
            shift
            ;;
        'rb')
            message "Installing Ruby Libraries"
            setup_ruby
            shift
            ;;
        'mac')
            message "Configuring Mac"
            setup_mac
            shift
            ;;
        "")
            exit 0
            ;;
        *)
            shift
            ;;
    esac
done
